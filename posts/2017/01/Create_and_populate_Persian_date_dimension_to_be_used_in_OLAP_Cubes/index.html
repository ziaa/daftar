<!DOCTYPE html>
<html lang="fa">
<head>
  	<title>ساختن بُعد تاریخ شمسی برای استفاده در Cube</title>

	<link rel="stylesheet" href="http://daftar.ziaa.ir/theme/css/bootstrap.css" type="text/css" />
	<link rel="stylesheet" href="http://daftar.ziaa.ir/theme/css/bootstrap-rtl.css" type="text/css" />
	<link rel="stylesheet" href="http://daftar.ziaa.ir/theme/css/pygments.css" type="text/css" />
	<link rel="stylesheet" href="http://daftar.ziaa.ir/theme/css/main.css" type="text/css" />
	<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>
	<script>
  		$(document).ready(function () {
    		$(".post table").addClass("table table-striped table-condensed table-bordered");
  	  	});
    </script>
	<meta charset="utf-8" />

	<link rel="alternate" href="http://daftar.ziaa.ir/feeds/all.atom.xml" type="application/atom+xml" title="خبرخوان دفتر -یادداشت‌های سید ضیاء الدین عظیمی " />


    <meta name="tags" content="SSAS" />
    <meta name="tags" content="OLAP Cube" />
    <meta name="tags" content="BI" />
    <meta name="tags" content="SQL Server Analysis Services" />
</head>
<body>
	<div class="wrap">
		<div class="container">
			<div class="banner">
				<a href="http://daftar.ziaa.ir">دفتر</a>
				<h1>یادداشت‌های سید ضیاء الدین عظیمی</h1>
			</div>
<div class="content">
	<div class="post">
		<h3>
			ساختن بُعد تاریخ شمسی برای استفاده در Cube
		</h3>
		<div class="info">
			سه شنبه 05 بهمن 1395
				توسط <a class="url fn" href="http://daftar.ziaa.ir/author/ziaa.html">Ziaa</a>
		</div>
		<div class="content">
			<p><img alt="DimPersianDate" src="http://daftar.ziaa.ir/posts/2017/01/Create_and_populate_Persian_date_dimension_to_be_used_in_OLAP_Cubes/Cube_DimPersianDate.PNG"></p>
<p>همان‌طور که می‌دانید در مباحث مربوط به هوش تجاری (BI)، یکی از پرکاربردترین  عناصر برای گزارش‌گیری‌های سریع، تلفیقی و چندبعدی OLAP Cubeها هستند (اگر نمی‌دانید، این متن برای شما کاربردی ندارد. وقت ارزشمند خود را تلف نکنید!). معمولاً در Cubeها <strong>بُعد تاریخ (Date dimension)</strong> یکی از اصلی‌ترین ابعاد است و در اکثر گزارش‌ها به آن نیاز خواهد شد.</p>
<p>برای ایجاد بُعد تاریخ با تاریخ‌های شمسی می‌توان ابتدا تابعی برای تبدیل تاریخ میلادی به شمسی در SQL Server نوشت. سپس با استفاده از این تابع، جدول تاریخ‌ها در انبارداده (Data Warehouse) را برای بازه‌ی زمانیِ خاصی ایجاد کرد.</p>
<h3>تابع تبدیل میلادی به شمسی در SQL Server</h3>
<p>برای این کار «چرخ را دوباره اختراع نمی‌کنیم» و از کد <a href="http://rastan.parsiblog.com/Posts/381">این وبلاگ</a> و البته <a href="http://mamehdi.parsiblog.com/Posts/1">نسخه سریع‌تر</a> آن (پی‌نوشت هفتم) برای ایجاد  <a href="https://github.com/ziaa/SqlPersianDateDimension/blob/master/GregorianToJalali.sql">تابع <code>GregorianToJalali</code></a> استفاده می‌کنیم. در عین حال <a href="https://github.com/ziaa/SqlPersianDateDimension/issues">مشکلات و باگ‌های این کد</a> را می‌دانیم.</p>
<h3>ایجاد روال (Stored Procedure) برای پرکردن بُعد تاریخ در انبار داده</h3>
<p>در اینجا <a href="https://github.com/ziaa/SqlPersianDateDimension/blob/master/spPopulatePersianDateDimension.sql">روال <code>spPopulatePersianDateDimension</code></a> را ایجاد می‌کنیم تا جدولی با عنوان <code>PersianDateDimension</code> در انبارداده ما ایجاد کند (اگر از قبل وجود نداشت) و سپس با توجه به ورودی روال، این جدول را با تاریخ‌های شمسی و میلادی متناظر برای <em>یک بازه زمانی خاص</em> پُر کند.</p>
<p>این روال، همه تاریخ‌های شمسی و میلادی بین تاریخ شروع <code>‪@FromDate‬</code> و پایان <code>‪@ToDate‬</code> را در جدول <code>PersianDateDimension</code>  وارد می‌کند. همان طور که در کد <a href="https://github.com/ziaa/SqlPersianDateDimension/blob/874230cbcd91c736f53cd7666022b439a8130364/spPopulatePersianDateDimension.sql#L28-L43">مشخص است</a> ستون‌هایی مانند «روز هفته (<code>GregorianDayNumberOfWeek</code> و <code>PersianDayNumberOfWeek</code>)» و «روز  سال (<code>GregorianDayNumberOfYear</code> و <code>PersianDayNumberOfYear</code>)» و ... نیز در این جدول وارد می‌شود که این موارد معمولاً در گزارش‌های جزئی‌تر مورد استفاده قرار می‌گیرند.</p>
<h3>پر کردن بُعد تاریخ برای یک بازه زمانی</h3>
<p>پس از ایجاد روال می‌توانیم با توجه به تاریخ‌های موجود در سایر داده‌ها و ابعاد (مثلاً مشتریان، محصولات، فروشندگان و ...) برای بازه‌ی معقولی بُعد تاریخ را ایجاد کنیم.</p>
<div class="highlight"><pre><span></span>EXECUTE dbo.spPopulatePersianDateDimension @FromDate = &#39;2016-1-1&#39;, @ToDate = &#39;2017-1-1&#39;
</pre></div>


<p>کار تمام است و شما می‌توانید این بُعد را برای سایر مکعب‌های خود نیز استفاده کنید.</p>
		</div>
	</div>
</div>
		</div>
		<div class="push"></div>
	</div>
	<div class="footer">
		<div class="container">
			<hr/>
				<ul class="nav nav-pills pull-right">
				  <li><a href="http://daftar.ziaa.ir/archives.html">بایگانی</a></li>
				  <li><a href="http://daftar.ziaa.ir/feeds/all.atom.xml">خبرخوان</a> </li>
				</ul>
		</div>
	</div>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-66952661-2']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = 'https://ssl.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>